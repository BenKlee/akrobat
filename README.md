# Akrobat repository

This is the main repository for the akrobat robot.
It contains the main ROS2 package. \
Additional packages for various sensors are:
- [akrobat_imu](https://github.com/informatik-mannheim/akrobat_imu.git)
- akrobat_depth_cam
- [akrobat_cam](https://github.com/informatik-mannheim/akrobat_cam.git) (needs ROS Humble implementation)


## In this readme

- [project structure](#project-structure)
    - [akrobat](#akrobat)
    - [config](#config)
    - [launch](#launch)
    - [resource](#resource)
    - [stl](#stl)
    - [test](#test)
    - [urdf](#urdf)
    - [test](#test)
    - [worlds](#worlds)
- [basic usage](#basic-usage)
- [installing dependencies](#installing-dependencies)
- [troubleshooting](#troubleshooting)


## Project structure

The projects' file structure looks as follows.

> __akrobat__ \
> ├── [__akrobat__](#akrobat) \
> ├── [__config__](#config) \
> ├── [__launch__](#launch) \
> ├── [__resource__](#resource) \
> ├── [__stl__](#stl) \
> ├── [__test__](#test) \
> ├── [__urdf__](#urdf) \
> ├── [__worlds__](#worlds) \
> ├── package.xml \
> ├── readme.md \
> ├── setup.cfg \
> └── setup.py
<!-- generated using `tree <akrobat directory> -L 1 --dirsfirst --sort name` -->

Each directory is explained further in the follwing sections.
For more information on ROS package structure see [the documentation](https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html).


### akrobat

Contains the code for all the nodes of the package.

> __akrobat/akrobat__ \
> ├── \_\_init__.py \
> ├── akrobat.py \
> ├── enums.py \
> └── joystick_emulator.py

- [`akrobat.py`](akrobat/akrobat.py) contains the code for the main node responsible for all logic of the robot.
- [`enums.py`](akrobat/enums.py) contains some enums used by `akrobat.py`.
- [`joystick_emulator.py`](akrobat/joystick_emulator.py) contains code for a separate node that can emulate a joystick input device using the keyboard.

### config

Contains various config files.

> __akrobat/config__ \
> ├── akrobat.rviz \
> ├── gazebo_bridge.yaml \
> ├── ros2_control_gazebo.yaml \
> └── ros2_control.yaml

- [`rviz.config`](config/rviz.config) saves which views will be opened in rviz on launch.

- [`gazebo_bridge.yaml`](config/gazebo_bridge.yaml) is used to configure the topic bridge between gazebo and ROS. \
This is used to publish simulated sensor data to ROS.

- [`ros2_control.yaml`](config/ros2_control.yaml) defines the controllers that should be loaded by the ros2_control controller manager which will control the motors (real or simulated). \
In addition, ros2_control needs some configuration in the robot's urdf (see that [section](#urdf)).

- [`ros2_control_gazebo.yaml`](config/ros2_control_gazebo.yaml) supplements [`ros2_control.yaml`](config/ros2_control.yaml) with additional parameters needed for ros2_control in gazebo.

### launch

Contains the launch files.

> __akrobat/launch__ \
> ├── __include__ \
> ├── main.launch.py \
> ├── simple.launch.py \
> └── simulation.launch.py

The three launch files have the following purpose:

- [`main.launch.py`](launch/main.launch.py) launches the real robot

- [`simulation.launch.py`](launch/simulation.launch.py) launches the robot in the gazebo simulator

- [`simple.launch.py`](launch/simple.launch.py) launches the robot only whith rviz, no simulation


### resource

Contains a file with the name of the package. This seems useless but is needed by ROS as a marker file for the package ([see docs](https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html#what-makes-up-a-ros-2-package)).


### stl

Contains the 3D model files of the robot.

> __akrobat/stl__ \
> ├── __collision__ \
> ├── __visual__ \
> └── akrobat.blend

There are two sets of models for each link of the robot. \
As labeled by the directories, one set is used for collision and contains simplified models to speed up computation in the simulation. \
The other set is used for visualization and the models have more details.

There is also a .blend file which is a Blender file containing all models if they need to be modified and re-exported as .stl files.

### test

Auto-generated by ROS.

> __akrobat/test__ \
> ├── test_copyright.py \
> ├── test_flake8.py \
> └── test_pep257.py

### urdf

Contains all files concerning the .urdf files of the robot.

> __akrobat/urdf__ \
> ├── akrobat.xacro \
> ├── gazebo.xacro \
> ├── inertia.py \
> ├── inertia.yaml \
> ├── leg.xacro \
> └── ros2_control.xacro

The files in this folder describe the structure of the robot to ROS. Check out the [urdf docs](https://docs.ros.org/en/humble/Tutorials/Intermediate/URDF/URDF-Main.html) for more information.

Instead of using plain urdf, the files are written with [xacro](https://docs.ros.org/en/humble/Tutorials/Intermediate/URDF/Using-Xacro-to-Clean-Up-a-URDF-File.html) which lets you define macros and other neat things to clean up large urdf files.

In addition to the several xacro files, there are two files which are used to calculate the inertia of the robot links. These are needed by gazebo and loaded into the urdf using xacro.

The files are structured in a way where [`akrobat.xacro`](urdf/akrobat.xacro) is the root file which will include all other files as needed. [`gazebo.xacro`](urdf/gazebo.xacro) defines simulated sensors for gazebo and [`ros2_control.xacro`](urdf/ros2_control.xacro) adds info needed for ros2_control in addition to [`ros2_control.yaml`](config/ros2_control.yaml) (see section [config](#config)).


### worlds

Contains gazebo world files.

> __akrobat/worlds__ \
> └── empty.sdf

At the moment this only contains one world file for an empty world. It is needed to define plugins for the simulated sensors defined in the [urdf](#urdf).

## Basic usage

### Build the packages
```
colcon build
source install/local_setup.bash
```
or combine into one command:
```
colcon build && source install/local_setup.bash
```

### Launch the packages

The launch files may have some launch arguments. You can list them like this:
```
ros2 launch akrobat <launch file> -s
```

The files can be lauched like this:
```
ros2 launch akrobat <launch file>
```

## Installing dependencies
Assuming `~/ros2_ws` as your workspace directory. \
After cloning all packages into `ros2_ws/src`, install all ROS dependencies using [rosdep](https://docs.ros.org/en/humble/Tutorials/Intermediate/Rosdep.html).
```
cd ~/ros2_ws
```
Initialize rosdep (this only needs to be done the first time you use rosdep):
```
sudo rosdep init
rosdep update
```
Install the dependencies of all packages in the `src` dir.
```
rosdep install --from-paths src -y --ignore-src
```

### Install dynamixel_control (ros2_control hardware interface)
In order to use ros2_control with the dynamixel motors, the dynamixel hardware interface is needed. Install as follows:
```
cd ~/ros2_ws/src
git clone https://github.com/youtalk/dynamixel_control.git -b humble dynamixel
vcs import dynamixel < dynamixel/dynamixel_control.repos
rosdep install --from-paths dynamixel --ignore-src -r -y
cd ~/ros2_ws/
colcon build --symlink-install --cmake-args -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
```

## Troubleshooting

```
~/ros2_ws$ ros2 launch akrobat main.launch.py
Package 'akrobat' not found: "package 'akrobat' not found, searching: ['/opt/ros/humble']"
```
Did you forget `source install/local_setup.bash` ?

